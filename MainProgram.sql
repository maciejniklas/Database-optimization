/* TABLES */
CREATE TABLE Address
(
  addressID NUMBER(9) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  country VARCHAR2(50) NOT NULL,
  town VARCHAR2(75) NOT NULL,
  street VARCHAR2(100) NOT NULL,
  zipCode CHAR(6) NOT NULL,
  CONSTRAINT ZipCodeCheck CHECK (zipCode LIKE '__-___')
);

CREATE TABLE Brewery
(
  breweryID NUMBER(9) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  addressID NUMBER(9) NOT NULL,
  breweryName VARCHAR2(100) NOT NULL,
  CONSTRAINT BreweryFK FOREIGN KEY (addressID) REFERENCES Address (addressID)
);

/* SEQUENCES */
CREATE SEQUENCE AddressSEQ START WITH 1;

/* TRIGGERS */
CREATE OR REPLACE TRIGGER BreweryTRIG BEFORE INSERT ON Brewery 
FOR EACH ROW 
BEGIN
  SELECT AddressSEQ.nextval INTO :new.addressID FROM dual;
END;
/

/* FILL DATABASE */
@D:\Repositories\DatabaseOptimization\GenerateAddressTable.sql;
@D:\Repositories\DatabaseOptimization\GenerateBreweryTable.sql;

/* DROP DATA NECESSARY ONLY FOR DATABASE FILL */
DROP SEQUENCE AddressSEQ;
DROP TRIGGER BreweryTRIG;